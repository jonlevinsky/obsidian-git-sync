import { __awaiter } from "tslib";
import { Modal, Notice, MarkdownView } from 'obsidian';
import * as path from 'path';
export class LocationManager {
    constructor(app, plugin) {
        this.app = app;
        this.plugin = plugin;
    }
    openLocationList() {
        new LocationListModal(this.app, this.plugin).open();
    }
    getLocationFiles(folderPath) {
        return __awaiter(this, void 0, void 0, function* () {
            const locationFolder = this.plugin.settings.defaultLocationFolder;
            return this.app.vault.getFiles().filter((file) => file.path.startsWith(path.join(folderPath, locationFolder)));
        });
    }
    createNewLocation(location, type, folderPath) {
        return __awaiter(this, void 0, void 0, function* () {
            if (this.plugin.settings.autoCreateFolders) {
                const locationFolderPath = path.join(folderPath, this.plugin.settings.defaultLocationFolder);
                try {
                    const folderExists = yield this.app.vault.adapter.exists(locationFolderPath);
                    if (!folderExists) {
                        yield this.app.vault.createFolder(locationFolderPath);
                    }
                }
                catch (error) {
                    console.error("Error creating folder:", error);
                    throw error;
                }
            }
            const locationFileName = `${type}-${location}-${path.basename(folderPath)}`;
            const locationFilePath = path.join(folderPath, this.plugin.settings.defaultLocationFolder, `${locationFileName}.md`);
            const file = yield this.app.vault.create(locationFilePath, `# ${locationFileName}`);
            return file;
        });
    }
}
class LocationListModal extends Modal {
    constructor(app, plugin) {
        super(app);
        this.plugin = plugin;
        this.editor = null;
        this.locationNames = [];
        this.folderPath = '';
        const activeLeaf = this.app.workspace.activeLeaf;
        if (activeLeaf && activeLeaf.view instanceof MarkdownView) {
            this.editor = activeLeaf.view.editor;
        }
    }
    onOpen() {
        const { contentEl } = this;
        contentEl.createEl('h2', { text: 'SELECT OR CREATE LOCATION' });
        const newLocationButton = contentEl.createEl('button', { text: '+ ADD NEW LOCATION' });
        newLocationButton.onclick = () => this.openNewLocationModal();
        const locationListContainer = contentEl.createEl('div', {
            cls: 'location-list-container'
        });
        this.loadLocations(locationListContainer);
    }
    onClose() {
        const { contentEl } = this;
        contentEl.empty();
    }
    loadLocations(locationListContainer) {
        return __awaiter(this, void 0, void 0, function* () {
            const activeFile = this.app.workspace.getActiveFile();
            if (!activeFile) {
                new Notice("NO FILE FOUND FOR THE CURRENT EDITOR.");
                return;
            }
            this.folderPath = path.dirname(activeFile.path);
            let locationFiles = yield this.plugin.locationManager.getLocationFiles(this.folderPath);
            locationFiles = locationFiles.filter((file) => file.path !== activeFile.path);
            if (locationFiles.length > 0) {
                this.locationNames = locationFiles.map((file) => path.basename(file.path, '.md'));
                this.locationNames.forEach(location => {
                    const locationItem = locationListContainer.createEl('button', { text: location });
                    locationItem.onclick = () => __awaiter(this, void 0, void 0, function* () {
                        yield this.openDayNightModal(location);
                    });
                });
            }
            else {
                locationListContainer.createEl('p', { text: 'NO LOCATIONS AVAILABLE. CREATE ONE!' });
            }
        });
    }
    openDayNightModal(location) {
        return __awaiter(this, void 0, void 0, function* () {
            new DayNightModal(this.app, location, (dayNight) => {
                this.insertLocationText(location, dayNight);
            }).open();
        });
    }
    insertLocationText(location, dayNight) {
        return __awaiter(this, void 0, void 0, function* () {
            const [type, locationNameAndDay] = location.split('-');
            const [locationName] = locationNameAndDay.split('-');
            const fileName = `${type.toUpperCase()}-${locationName.toUpperCase()}-${path.basename(this.folderPath)}`;
            const formattedLocationText = `# ${type.toUpperCase()}. [[${fileName}|${locationName.toUpperCase()}]] - ${dayNight.toUpperCase()}`;
            const text = `${formattedLocationText}\n`;
            if (this.editor) {
                this.editor.replaceRange(text, this.editor.getCursor());
            }
            this.close();
        });
    }
    openNewLocationModal() {
        return __awaiter(this, void 0, void 0, function* () {
            new NewLocationModal(this.app, this.plugin, this.folderPath).open();
        });
    }
}
class DayNightModal extends Modal {
    constructor(app, location, callback) {
        super(app);
        this.location = location;
        this.callback = callback;
    }
    onOpen() {
        const { contentEl } = this;
        contentEl.createEl('h2', { text: `SELECT TIME FOR LOCATION: ${this.location}` });
        const dayButton = contentEl.createEl('button', { text: 'DAY' });
        dayButton.onclick = () => this.selectDayNight('DAY');
        const nightButton = contentEl.createEl('button', { text: 'NIGHT' });
        nightButton.onclick = () => this.selectDayNight('NIGHT');
    }
    onClose() {
        const { contentEl } = this;
        contentEl.empty();
    }
    selectDayNight(dayNight) {
        this.callback(dayNight);
        this.close();
    }
}
class NewLocationModal extends Modal {
    constructor(app, plugin, folderPath) {
        super(app);
        this.plugin = plugin;
        this.folderPath = folderPath;
        this.typeSelect = null;
        this.locationNameInput = null;
    }
    onOpen() {
        const { contentEl } = this;
        contentEl.createEl('h2', { text: 'CREATE NEW LOCATION' });
        this.typeSelect = contentEl.createEl('select');
        this.typeSelect.createEl('option', { text: 'INT', value: 'INT' });
        this.typeSelect.createEl('option', { text: 'EXT', value: 'EXT' });
        this.locationNameInput = contentEl.createEl('input', { type: 'text', placeholder: 'Enter location name' });
        const createButton = contentEl.createEl('button', { text: 'CREATE' });
        createButton.onclick = () => __awaiter(this, void 0, void 0, function* () {
            if (this.typeSelect && this.locationNameInput) {
                const type = this.typeSelect.value;
                const locationName = this.locationNameInput.value.trim().toUpperCase();
                if (locationName) {
                    yield this.plugin.locationManager.createNewLocation(locationName, type, this.folderPath);
                    this.close();
                    new Notice(`Location ${type}-${locationName} created successfully!`);
                }
            }
        });
    }
    onClose() {
        const { contentEl } = this;
        contentEl.empty();
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibG9jYXRpb25zLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vb2JzaWRpYW4gcGx1Z2luL2NlbHR4L3NyYy9sb2NhdGlvbnMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFBTyxLQUFLLEVBQUUsTUFBTSxFQUFpQixZQUFZLEVBQUUsTUFBTSxVQUFVLENBQUM7QUFFM0UsT0FBTyxLQUFLLElBQUksTUFBTSxNQUFNLENBQUM7QUFFN0IsTUFBTSxPQUFPLGVBQWU7SUFDeEIsWUFBb0IsR0FBUSxFQUFVLE1BQTJCO1FBQTdDLFFBQUcsR0FBSCxHQUFHLENBQUs7UUFBVSxXQUFNLEdBQU4sTUFBTSxDQUFxQjtJQUFHLENBQUM7SUFFckUsZ0JBQWdCO1FBQ1osSUFBSSxpQkFBaUIsQ0FBQyxJQUFJLENBQUMsR0FBRyxFQUFFLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQyxJQUFJLEVBQUUsQ0FBQztJQUN4RCxDQUFDO0lBRUssZ0JBQWdCLENBQUMsVUFBa0I7O1lBQ3JDLE1BQU0sY0FBYyxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsUUFBUSxDQUFDLHFCQUFxQixDQUFDO1lBQ2xFLE9BQU8sSUFBSSxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsUUFBUSxFQUFFLENBQUMsTUFBTSxDQUFDLENBQUMsSUFBVyxFQUFFLEVBQUUsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLFVBQVUsRUFBRSxjQUFjLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDMUgsQ0FBQztLQUFBO0lBRUssaUJBQWlCLENBQUMsUUFBZ0IsRUFBRSxJQUFZLEVBQUUsVUFBa0I7O1lBQ3RFLElBQUksSUFBSSxDQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUMsaUJBQWlCLEVBQUUsQ0FBQztnQkFDekMsTUFBTSxrQkFBa0IsR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLFVBQVUsRUFBRSxJQUFJ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QyxNQUFNLElBQUksR0FBRyxJQUFJLENBQUMsVUFBVSxDQUFDLEtBQUssQ0FBQztnQkFDbkMsTUFBTSxZQUFZLEdBQUcsSUFBSSxDQUFDLGlCQUFpQixDQUFDLEtBQUssQ0FBQyxJQUFJLEVBQUUsQ0FBQyxXQUFXLEVBQUUsQ0FBQztnQkFDdkUsSUFBSSxZQUFZLEVBQUUsQ0FBQztvQkFDZixNQUFNLElBQUksQ0FBQyxNQUFNLENBQUMsZUFBZSxDQUFDLGlCQUFpQixDQUFDLFlBQVksRUFBRSxJQUFJLEVBQUUsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDO29CQUN6RixJQUFJLENBQUMsS0FBSyxFQUFFLENBQUM7b0JBQ2IsSUFBSSxNQUFNLENBQUMsWUFBWSxJQUFJLElBQUksWUFBWSx3QkFBd0IsQ0FBQyxDQUFDO2dCQUN6RSxDQUFDO1lBQ0wsQ0FBQztRQUNMLENBQUMsQ0FBQSxDQUFDO0lBQ04sQ0FBQztJQUVELE9BQU87UUFDSCxNQUFNLEVBQUUsU0FBUyxFQUFFLEdBQUcsSUFBSSxDQUFDO1FBQzNCLFNBQVMsQ0FBQyxLQUFLLEVBQUUsQ0FBQztJQUN0QixDQUFDO0NBQ0oiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBcHAsIE1vZGFsLCBOb3RpY2UsIFRGaWxlLCBFZGl0b3IsIE1hcmtkb3duVmlldyB9IGZyb20gJ29ic2lkaWFuJztcclxuaW1wb3J0IFNjcmlwdFdyaXRpbmdQbHVnaW4gZnJvbSAnLi9tYWluJztcclxuaW1wb3J0ICogYXMgcGF0aCBmcm9tICdwYXRoJztcclxuXHJcbmV4cG9ydCBjbGFzcyBMb2NhdGlvbk1hbmFnZXIge1xyXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBhcHA6IEFwcCwgcHJpdmF0ZSBwbHVnaW46IFNjcmlwdFdyaXRpbmdQbHVnaW4pIHt9XHJcblxyXG4gICAgb3BlbkxvY2F0aW9uTGlzdCgpIHtcclxuICAgICAgICBuZXcgTG9jYXRpb25MaXN0TW9kYWwodGhpcy5hcHAsIHRoaXMucGx1Z2luKS5vcGVuKCk7XHJcbiAgICB9XHJcblxyXG4gICAgYXN5bmMgZ2V0TG9jYXRpb25GaWxlcyhmb2xkZXJQYXRoOiBzdHJpbmcpOiBQcm9taXNlPFRGaWxlW10+IHtcclxuICAgICAgICBjb25zdCBsb2NhdGlvbkZvbGRlciA9IHRoaXMucGx1Z2luLnNldHRpbmdzLmRlZmF1bHRMb2NhdGlvbkZvbGRlcjtcclxuICAgICAgICByZXR1cm4gdGhpcy5hcHAudmF1bHQuZ2V0RmlsZXMoKS5maWx0ZXIoKGZpbGU6IFRGaWxlKSA9PiBmaWxlLnBhdGguc3RhcnRzV2l0aChwYXRoLmpvaW4oZm9sZGVyUGF0aCwgbG9jYXRpb25Gb2xkZXIpKSk7XHJcbiAgICB9XHJcblxyXG4gICAgYXN5bmMgY3JlYXRlTmV3TG9jYXRpb24obG9jYXRpb246IHN0cmluZywgdHlwZTogc3RyaW5nLCBmb2xkZXJQYXRoOiBzdHJpbmcpOiBQcm9taXNlPFRGaWxlPiB7XHJcbiAgICAgICAgaWYgKHRoaXMucGx1Z2luLnNldHRpbmdzLmF1dG9DcmVhdGVGb2xkZXJzKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGxvY2F0aW9uRm9sZGVyUGF0aCA9IHBhdGguam9pbihmb2xkZXJQYXRoLCB0aGlzLnBsdWdpbi5zZXR0aW5ncy5kZWZhdWx0TG9jYXRpb25Gb2xkZXIpO1xyXG4gICAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgZm9sZGVyRXhpc3RzID0gYXdhaXQgdGhpcy5hcHAudmF1bHQuYWRhcHRlci5leGlzdHMobG9jYXRpb25Gb2xkZXJQYXRoKTtcclxuICAgICAgICAgICAgICAgIGlmICghZm9sZGVyRXhpc3RzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5hcHAudmF1bHQuY3JlYXRlRm9sZGVyKGxvY2F0aW9uRm9sZGVyUGF0aCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgY3JlYXRpbmcgZm9sZGVyOlwiLCBlcnJvcik7XHJcbiAgICAgICAgICAgICAgICB0aHJvdyBlcnJvcjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgbG9jYXRpb25GaWxlTmFtZSA9IGAke3R5cGV9LSR7bG9jYXRpb259LSR7cGF0aC5iYXNlbmFtZShmb2xkZXJQYXRoKX1gO1xyXG4gICAgICAgIGNvbnN0IGxvY2F0aW9uRmlsZVBhdGggPSBwYXRoLmpvaW4oZm9sZGVyUGF0aCwgdGhpcy5wbHVnaW4uc2V0dGluZ3MuZGVmYXVsdExvY2F0aW9uRm9sZGVyLCBgJHtsb2NhdGlvbkZpbGVOYW1lfS5tZGApO1xyXG5cclxuICAgICAgICBjb25zdCBmaWxlID0gYXdhaXQgdGhpcy5hcHAudmF1bHQuY3JlYXRlKGxvY2F0aW9uRmlsZVBhdGgsIGAjICR7bG9jYXRpb25GaWxlTmFtZX1gKTtcclxuICAgICAgICByZXR1cm4gZmlsZTtcclxuICAgIH1cclxufVxyXG5cclxuY2xhc3MgTG9jYXRpb25MaXN0TW9kYWwgZXh0ZW5kcyBNb2RhbCB7XHJcbiAgICBwcml2YXRlIGVkaXRvcjogRWRpdG9yIHwgbnVsbCA9IG51bGw7XHJcbiAgICBwcml2YXRlIGxvY2F0aW9uTmFtZXM6IHN0cmluZ1tdID0gW107XHJcbiAgICBwcml2YXRlIGZvbGRlclBhdGg6IHN0cmluZyA9ICcnO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKGFwcDogQXBwLCBwcml2YXRlIHBsdWdpbjogU2NyaXB0V3JpdGluZ1BsdWdpbikge1xyXG4gICAgICAgIHN1cGVyKGFwcCk7XHJcbiAgICAgICAgY29uc3QgYWN0aXZlTGVhZiA9IHRoaXMuYXBwLndvcmtzcGFjZS5hY3RpdmVMZWFmO1xyXG4gICAgICAgIGlmIChhY3RpdmVMZWFmICYmIGFjdGl2ZUxlYWYudmlldyBpbnN0YW5jZW9mIE1hcmtkb3duVmlldykge1xyXG4gICAgICAgICAgICB0aGlzLmVkaXRvciA9IGFjdGl2ZUxlYWYudmlldy5lZGl0b3I7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIG9uT3BlbigpIHtcclxuICAgICAgICBjb25zdCB7IGNvbnRlbnRFbCB9ID0gdGhpcztcclxuICAgICAgICBjb250ZW50RWwuY3JlYXRlRWwoJ2gyJywgeyB0ZXh0OiAnU0VMRUNUIE9SIENSRUFURSBMT0NBVElPTicgfSk7XHJcblxyXG4gICAgICAgIGNvbnN0IG5ld0xvY2F0aW9uQnV0dG9uID0gY29udGVudEVsLmNyZWF0ZUVsKCdidXR0b24nLCB7IHRleHQ6ICcrIEFERCBORVcgTE9DQVRJT04nIH0pO1xyXG4gICAgICAgIG5ld0xvY2F0aW9uQnV0dG9uLm9uY2xpY2sgPSAoKSA9PiB0aGlzLm9wZW5OZXdMb2NhdGlvbk1vZGFsKCk7XHJcblxyXG4gICAgICAgIGNvbnN0IGxvY2F0aW9uTGlzdENvbnRhaW5lciA9IGNvbnRlbnRFbC5jcmVhdGVFbCgnZGl2Jywge1xyXG4gICAgICAgICAgICBjbHM6ICdsb2NhdGlvbi1saXN0LWNvbnRhaW5lcidcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgdGhpcy5sb2FkTG9jYXRpb25zKGxvY2F0aW9uTGlzdENvbnRhaW5lcik7XHJcbiAgICB9XHJcblxyXG4gICAgb25DbG9zZSgpIHtcclxuICAgICAgICBjb25zdCB7IGNvbnRlbnRFbCB9ID0gdGhpcztcclxuICAgICAgICBjb250ZW50RWwuZW1wdHkoKTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGFzeW5jIGxvYWRMb2NhdGlvbnMobG9jYXRpb25MaXN0Q29udGFpbmVyOiBIVE1MRWxlbWVudCkge1xyXG4gICAgICAgIGNvbnN0IGFjdGl2ZUZpbGUgPSB0aGlzLmFwcC53b3Jrc3BhY2UuZ2V0QWN0aXZlRmlsZSgpO1xyXG4gICAgICAgIGlmICghYWN0aXZlRmlsZSkge1xyXG4gICAgICAgICAgICBuZXcgTm90aWNlKFwiTk8gRklMRSBGT1VORCBGT1IgVEhFIENVUlJFTlQgRURJVE9SLlwiKTtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5mb2xkZXJQYXRoID0gcGF0aC5kaXJuYW1lKGFjdGl2ZUZpbGUucGF0aCk7XHJcblxyXG4gICAgICAgIGxldCBsb2NhdGlvbkZpbGVzID0gYXdhaXQgdGhpcy5wbHVnaW4ubG9jYXRpb25NYW5hZ2VyLmdldExvY2F0aW9uRmlsZXModGhpcy5mb2xkZXJQYXRoKTtcclxuICAgICAgICBsb2NhdGlvbkZpbGVzID0gbG9jYXRpb25GaWxlcy5maWx0ZXIoKGZpbGU6IFRGaWxlKSA9PiBmaWxlLnBhdGggIT09IGFjdGl2ZUZpbGUucGF0aCk7XHJcblxyXG4gICAgICAgIGlmIChsb2NhdGlvbkZpbGVzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgdGhpcy5sb2NhdGlvbk5hbWVzID0gbG9jYXRpb25GaWxlcy5tYXAoKGZpbGU6IFRGaWxlKSA9PiBwYXRoLmJhc2VuYW1lKGZpbGUucGF0aCwgJy5tZCcpKTtcclxuXHJcbiAgICAgICAgICAgIHRoaXMubG9jYXRpb25OYW1lcy5mb3JFYWNoKGxvY2F0aW9uID0+IHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGxvY2F0aW9uSXRlbSA9IGxvY2F0aW9uTGlzdENvbnRhaW5lci5jcmVhdGVFbCgnYnV0dG9uJywgeyB0ZXh0OiBsb2NhdGlvbiB9KTtcclxuICAgICAgICAgICAgICAgIGxvY2F0aW9uSXRlbS5vbmNsaWNrID0gYXN5bmMgKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMub3BlbkRheU5pZ2h0TW9kYWwobG9jYXRpb24pO1xyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgbG9jYXRpb25MaXN0Q29udGFpbmVyLmNyZWF0ZUVsKCdwJywgeyB0ZXh0OiAnTk8gTE9DQVRJT05TIEFWQUlMQUJMRS4gQ1JFQVRFIE9ORSEnIH0pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGFzeW5jIG9wZW5EYXlOaWdodE1vZGFsKGxvY2F0aW9uOiBzdHJpbmcpIHtcclxuICAgICAgICBuZXcgRGF5TmlnaHRNb2RhbCh0aGlzLmFwcCwgbG9jYXRpb24sIChkYXlOaWdodDogc3RyaW5nKSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuaW5zZXJ0TG9jYXRpb25UZXh0KGxvY2F0aW9uLCBkYXlOaWdodCk7XHJcbiAgICAgICAgfSkub3BlbigpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgYXN5bmMgaW5zZXJ0TG9jYXRpb25UZXh0KGxvY2F0aW9uOiBzdHJpbmcsIGRheU5pZ2h0OiBzdHJpbmcpIHtcclxuICAgICAgICBjb25zdCBbdHlwZSwgbG9jYXRpb25OYW1lQW5kRGF5XSA9IGxvY2F0aW9uLnNwbGl0KCctJyk7XHJcbiAgICAgICAgY29uc3QgW2xvY2F0aW9uTmFtZV0gPSBsb2NhdGlvbk5hbWVBbmREYXkuc3BsaXQoJy0nKTtcclxuICAgIFxyXG4gICAgICAgIGNvbnN0IGZpbGVOYW1lID0gYCR7dHlwZS50b1VwcGVyQ2FzZSgpfS0ke2xvY2F0aW9uTmFtZS50b1VwcGVyQ2FzZSgpfS0ke3BhdGguYmFzZW5hbWUodGhpcy5mb2xkZXJQYXRoKX1gO1xyXG4gICAgICAgIGNvbnN0IGZvcm1hdHRlZExvY2F0aW9uVGV4dCA9IGAjICR7dHlwZS50b1VwcGVyQ2FzZSgpfS4gW1ske2ZpbGVOYW1lfXwke2xvY2F0aW9uTmFtZS50b1VwcGVyQ2FzZSgpfV1dIC0gJHtkYXlOaWdodC50b1VwcGVyQ2FzZSgpfWA7XHJcbiAgICBcclxuICAgICAgICBjb25zdCB0ZXh0ID0gYCR7Zm9ybWF0dGVkTG9jYXRpb25UZXh0fVxcbmA7XHJcbiAgICAgICAgaWYgKHRoaXMuZWRpdG9yKSB7XHJcbiAgICAgICAgICAgIHRoaXMuZWRpdG9yLnJlcGxhY2VSYW5nZSh0ZXh0LCB0aGlzLmVkaXRvci5nZXRDdXJzb3IoKSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuY2xvc2UoKTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGFzeW5jIG9wZW5OZXdMb2NhdGlvbk1vZGFsKCkge1xyXG4gICAgICAgIG5ldyBOZXdMb2NhdGlvbk1vZGFsKHRoaXMuYXBwLCB0aGlzLnBsdWdpbiwgdGhpcy5mb2xkZXJQYXRoKS5vcGVuKCk7XHJcbiAgICB9XHJcbn1cclxuXHJcbmNsYXNzIERheU5pZ2h0TW9kYWwgZXh0ZW5kcyBNb2RhbCB7XHJcbiAgICBjb25zdHJ1Y3RvcihhcHA6IEFwcCwgcHJpdmF0ZSBsb2NhdGlvbjogc3RyaW5nLCBwcml2YXRlIGNhbGxiYWNrOiAoZGF5TmlnaHQ6IHN0cmluZykgPT4gdm9pZCkge1xyXG4gICAgICAgIHN1cGVyKGFwcCk7XHJcbiAgICB9XHJcblxyXG4gICAgb25PcGVuKCkge1xyXG4gICAgICAgIGNvbnN0IHsgY29udGVudEVsIH0gPSB0aGlzO1xyXG4gICAgICAgIGNvbnRlbnRFbC5jcmVhdGVFbCgnaDInLCB7IHRleHQ6IGBTRUxFQ1QgVElNRSBGT1IgTE9DQVRJT046ICR7dGhpcy5sb2NhdGlvbn1gIH0pO1xyXG5cclxuICAgICAgICBjb25zdCBkYXlCdXR0b24gPSBjb250ZW50RWwuY3JlYXRlRWwoJ2J1dHRvbicsIHsgdGV4dDogJ0RBWScgfSk7XHJcbiAgICAgICAgZGF5QnV0dG9uLm9uY2xpY2sgPSAoKSA9PiB0aGlzLnNlbGVjdERheU5pZ2h0KCdEQVknKTtcclxuXHJcbiAgICAgICAgY29uc3QgbmlnaHRCdXR0b24gPSBjb250ZW50RWwuY3JlYXRlRWwoJ2J1dHRvbicsIHsgdGV4dDogJ05JR0hUJyB9KTtcclxuICAgICAgICBuaWdodEJ1dHRvbi5vbmNsaWNrID0gKCkgPT4gdGhpcy5zZWxlY3REYXlOaWdodCgnTklHSFQnKTtcclxuICAgIH1cclxuXHJcbiAgICBvbkNsb3NlKCkge1xyXG4gICAgICAgIGNvbnN0IHsgY29udGVudEVsIH0gPSB0aGlzO1xyXG4gICAgICAgIGNvbnRlbnRFbC5lbXB0eSgpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgc2VsZWN0RGF5TmlnaHQoZGF5TmlnaHQ6IHN0cmluZykge1xyXG4gICAgICAgIHRoaXMuY2FsbGJhY2soZGF5TmlnaHQpO1xyXG4gICAgICAgIHRoaXMuY2xvc2UoKTtcclxuICAgIH1cclxufVxyXG5cclxuY2xhc3MgTmV3TG9jYXRpb25Nb2RhbCBleHRlbmRzIE1vZGFsIHtcclxuICAgIHByaXZhdGUgdHlwZVNlbGVjdDogSFRNTFNlbGVjdEVsZW1lbnQgfCBudWxsID0gbnVsbDtcclxuICAgIHByaXZhdGUgbG9jYXRpb25OYW1lSW5wdXQ6IEhUTUxJbnB1dEVsZW1lbnQgfCBudWxsID0gbnVsbDtcclxuXHJcbiAgICBjb25zdHJ1Y3RvcihhcHA6IEFwcCwgcHJpdmF0ZSBwbHVnaW46IFNjcmlwdFdyaXRpbmdQbHVnaW4sIHByaXZhdGUgZm9sZGVyUGF0aDogc3RyaW5nKSB7XHJcbiAgICAgICAgc3VwZXIoYXBwKTtcclxuICAgIH1cclxuXHJcbiAgICBvbk9wZW4oKSB7XHJcbiAgICAgICAgY29uc3QgeyBjb250ZW50RWwgfSA9IHRoaXM7XHJcbiAgICAgICAgY29udGVudEVsLmNyZWF0ZUVsKCdoMicsIHsgdGV4dDogJ0NSRUFURSBORVcgTE9DQVRJT04nIH0pO1xyXG5cclxuICAgICAgICB0aGlzLnR5cGVTZWxlY3QgPSBjb250ZW50RWwuY3JlYXRlRWwoJ3NlbGVjdCcpO1xyXG4gICAgICAgIHRoaXMudHlwZVNlbGVjdC5jcmVhdGVFbCgnb3B0aW9uJywgeyB0ZXh0OiAnSU5UJywgdmFsdWU6ICdJTlQnIH0pO1xyXG4gICAgICAgIHRoaXMudHlwZVNlbGVjdC5jcmVhdGVFbCgnb3B0aW9uJywgeyB0ZXh0OiAnRVhUJywgdmFsdWU6ICdFWFQnIH0pO1xyXG5cclxuICAgICAgICB0aGlzLmxvY2F0aW9uTmFtZUlucHV0ID0gY29udGVudEVsLmNyZWF0ZUVsKCdpbnB1dCcsIHsgdHlwZTogJ3RleHQnLCBwbGFjZWhvbGRlcjogJ0VudGVyIGxvY2F0aW9uIG5hbWUnIH0pO1xyXG5cclxuICAgICAgICBjb25zdCBjcmVhdGVCdXR0b24gPSBjb250ZW50RWwuY3JlYXRlRWwoJ2J1dHRvbicsIHsgdGV4dDogJ0NSRUFURScgfSk7XHJcbiAgICAgICAgY3JlYXRlQnV0dG9uLm9uY2xpY2sgPSBhc3luYyAoKSA9PiB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLnR5cGVTZWxlY3QgJiYgdGhpcy5sb2NhdGlvbk5hbWVJbnB1dCkge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgdHlwZSA9IHRoaXMudHlwZVNlbGVjdC52YWx1ZTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGxvY2F0aW9uTmFtZSA9IHRoaXMubG9jYXRpb25OYW1lSW5wdXQudmFsdWUudHJpbSgpLnRvVXBwZXJDYXNlKCk7XHJcbiAgICAgICAgICAgICAgICBpZiAobG9jYXRpb25OYW1lKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4ubG9jYXRpb25NYW5hZ2VyLmNyZWF0ZU5ld0xvY2F0aW9uKGxvY2F0aW9uTmFtZSwgdHlwZSwgdGhpcy5mb2xkZXJQYXRoKTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmNsb3NlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgbmV3IE5vdGljZShgTG9jYXRpb24gJHt0eXBlfS0ke2xvY2F0aW9uTmFtZX0gY3JlYXRlZCBzdWNjZXNzZnVsbHkhYCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgfVxyXG5cclxuICAgIG9uQ2xvc2UoKSB7XHJcbiAgICAgICAgY29uc3QgeyBjb250ZW50RWwgfSA9IHRoaXM7XHJcbiAgICAgICAgY29udGVudEVsLmVtcHR5KCk7XHJcbiAgICB9XHJcbn1cclxuXHJcbiJdfQ==